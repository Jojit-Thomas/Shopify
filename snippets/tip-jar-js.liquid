<!-- Tip Jar JS --><script>let tjWidget=document.querySelectorAll("#tipjar-container"),activeWidget=!1,installChecked=!1;for(var i=0;i<tjWidget.length;i++)tjWidget[i]&&(activeWidget=!0,tjWidget[i].setAttribute("data-active",!0));activeWidget&&(activateWidget(),installChecked=!0);let checkWidget=setInterval(function(){let e=document.querySelectorAll("#tipjar-container");for(var t=0;t<e.length;t++)e[t]&&!e[t].hasAttribute("data-active")&&(e[t].setAttribute("data-active",!0),activateWidget())},100);function activateWidget(){installChecked||checkInstall(),clearLocalStorage();for(var e=document.querySelectorAll(".tipjar-wrapper"),t=!1,a=0;a<e.length;a++){"false"==e[a].getAttribute("data-add-multiple")&&localStorage.btnTxt&&(t=!0)}t&&getStorage();var r=document.querySelectorAll(".tipjar-amounts");for(a=0;a<r.length;a++){if("fixed_percentage"==(i=r[a].getAttribute("data-amount-display"))){var l=document.getElementsByClassName("atipamount"),o=document.querySelectorAll(".initial-tip-value");for(a=0;a<o.length;a++){var n=o[a].getAttribute("data-percent-value");o[a].innerText+=" ("+n+"%)";for(a=0;a<l.length;a++){var i=l[a].getAttribute("data-percent-value");l[a].innerText+=" ("+i+"%)"}}}}var c=document.querySelectorAll(".initial-tip-value");for(a=0;a<c.length;a++){if("true"==c[a].getAttribute("data-auto-add")){var d=document.querySelectorAll(".tipjar-amounts");for(a=0;a<d.length;a++){function u(){for(var e=document.querySelectorAll(".tipjar-amounts"),t=document.getElementsByClassName("atipamount"),a=!1,r=0;r<e.length;r++){var l=e[r].value;for(r=0;r<t.length;r++)t[r].value==l&&(a=!0)}a&&addTipToCart()}d[a].addEventListener("change",u)}}var s=document.querySelectorAll(".tipjar-btn");for(a=0;a<s.length;a++)s[a].addEventListener("click",addTipToCart)}}function addTipToCart(){for(var e=document.querySelectorAll(".tipjar-amounts"),t=0;t<e.length;t++)var a=e[t].value;var r={items:[{quantity:1,id:a}]};fetch("/cart/add.js",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>tipAddedToCart()).catch(e=>tipFailedToAdd())}function tipAddedToCart(){for(var e,t,a=document.querySelectorAll(".tipjar-amounts"),r=document.querySelectorAll(".tipjar-btn"),l=0;l<a.length;l++)e=a[l].value;for(l=0;l<r.length;l++)t=r[l].getAttribute("data-after");localStorage.setItem("btnTxt",t),localStorage.setItem("selDisable","true"),localStorage.setItem("btnDisable","not-active"),localStorage.setItem("selVal",e),getStorage(),window.location.reload()}function tipFailedToAdd(){for(var e=document.querySelectorAll(".tipjar-btn"),t=document.querySelectorAll(".tipjar-err-message"),a=0;a<t.length;a++)t[a].classList.remove("hidden-err-message"),t[a].innerHTML="Connection error, tip was not added, please refresh the page and try again.";for(a=0;a<e.length;a++)e[a].innerHTML="ERROR"}function getStorage(){for(var e=document.getElementsByClassName("atipamount"),t=document.querySelectorAll(".tipjar-btn"),a=0;a<t.length;a++)t[a].innerHTML=localStorage.getItem("btnTxt");var r=document.querySelectorAll(".tipjar-amounts");for(a=0;a<r.length;a++)r[a].setAttribute("disabled",localStorage.getItem("selDisable"));var l=document.querySelectorAll(".tipjar-wrapper");for(a=0;a<l.length;a++)l[a].classList.add(localStorage.getItem("btnDisable"));for(a=0;a<e.length;a++)e[a].value==localStorage.getItem("selVal")&&e[a].setAttribute("selected",localStorage.getItem("selDisable"))}function clearLocalStorage(){for(var e,t=document.querySelectorAll(".tipjar-btn"),a=document.querySelectorAll(".tipjar-amounts"),r=document.getElementsByClassName("atipamount"),l=0;l<t.length;l++)e=t[l].getAttribute("data-before");var o=document.querySelectorAll(".initial-tip-value");fetch("/cart.js").then(e=>e.json()).then(l=>{for(var n=!1,i=0;i<l.items.length;i++)"tip-jar-app"==l.items[i].handle&&(n=!0);if(0==n){localStorage.removeItem("btnTxt"),localStorage.removeItem("selDisable"),localStorage.removeItem("btnDisable"),localStorage.removeItem("selVal");for(i=0;i<t.length;i++)t[i].innerHTML=e;var c=document.querySelectorAll(".tipjar-wrapper");for(i=0;i<c.length;i++)c[i].classList.remove("not-active");for(i=0;i<a.length;i++)a[i].removeAttribute("disabled");for(i=0;i<o.length;i++)o[i].setAttribute("selected","true");for(i=0;i<r.length;i++)r[i].removeAttribute("selected")}})}function checkInstall(){fetch("https://io.thetipjar.app/api/v1/tjtoken.json?shop={{shop.permanent_domain}}").then(e=>e.json()).then(e=>{if(0==e.t)for(var t=document.querySelectorAll("#tipjar-container"),a=0;a<t.length;a++)t[a].style.display="none"})}</script>